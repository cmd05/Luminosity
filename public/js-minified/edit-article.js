import{newTokenData,URL,isJson,clipboardCopy}from"./script.js";let title,tagline,content,tags;const saveBtn=document.querySelector("#save-changes"),articleId=document.querySelector("[name='article_id']").value,toast=document.getElementById("article-err-toast"),toastBody=toast.querySelector(".toast-body");function updateVars(){title=document.querySelector("#title").value,tagline=document.querySelector("#tagline").value,content=document.querySelector(".ql-editor").innerHTML,tags=document.querySelector("#tags").value}function changeSaveBtnState(){let e=title,t=tagline,a=content,n=tags;updateVars(),e==title&&t==tagline&&a==content&&n==tags||(saveBtn.classList.add("btn-info"),saveBtn.classList.remove("btn-success"),saveBtn.innerText="Publish Changes")}function updateArticle(){updateVars();const e=newTokenData({title:title,tagline:tagline,tags:tags,content:content,article_id:articleId});toastBody.innerHTML='Saving Changes   <i class="fas fa-circle-notch fa-spin"></i>';let t=new bootstrap.Toast(toast,{delay:15e3});t.show(),fetch(`${URL}/ajax/write/update-article`,{method:"POST",body:e}).then(e=>e.text()).then(e=>{if(isJson(e)){let t=JSON.parse(e);200===t.status?location.replace(`${URL}/article?a=${articleId}`):(delete t.status,toastBody.innerHTML=`${t[Object.keys(t)[0]]}`)}setTimeout(function(){t.hide()},2e3)})}setTimeout(function(){updateVars(),window.setInterval(changeSaveBtnState,1e3)},2e3),document.querySelector("#delete").addEventListener("click",function(){let e=prompt("Enter username to delete article: ")??" ";const t=newTokenData({username:e,article_id:articleId});toastBody.innerHTML="Delete";let a=new bootstrap.Toast(toast,{delay:5e3});a.show(),fetch(`${URL}/ajax/write/delete-article`,{method:"POST",body:t}).then(e=>e.text()).then(e=>{if(isJson(e)){let t=JSON.parse(e);200===t.status?location.replace(`${URL}/write/articles`):(delete t.status,toastBody.innerHTML=`${t[Object.keys(t)[0]]}`)}setTimeout(function(){a.hide()},3e3)})}),saveBtn.addEventListener("click",updateArticle),document.querySelector("#copy-link").addEventListener("click",function(){clipboardCopy(`${URL}/write/edit-article/${articleId}`),toastBody.innerHTML="Copied Link",new bootstrap.Toast(toast,{delay:2e3}).show()})
import{URL,clipboardCopy,newTokenData,isJson,LiveLoader,ht}from"./script.js";const toast=document.getElementById("articles-toast"),toastBody=toast.querySelector(".toast-body");function isBlank(t){return!t||/^\s*$/.test(t)}document.addEventListener("click",t=>{if(t.target.classList.contains("copy-link")){clipboardCopy(t.target.getAttribute("data-link")),toastBody.innerHTML="Copied Link",new bootstrap.Toast(toast,{delay:2e3}).show()}else if(t.target.classList.contains("delete-article")){let e=prompt("Enter username to delete article: ")??" ";const a=newTokenData({username:e,article_id:t.target.getAttribute("data-delete-id")});toastBody.innerHTML="Delete";let n=new bootstrap.Toast(toast,{delay:5e3});n.show(),fetch(`${URL}/ajax/write/delete-article`,{method:"POST",body:a}).then(t=>t.text()).then(e=>{if(isJson(e)){let a=JSON.parse(e);if(200===a.status){toastBody.innerHTML="Article Deleted",new bootstrap.Toast(toast,{delay:2e3}).show(),t.target.closest(".col").remove()}else delete a.status,toastBody.innerHTML=`${a[Object.keys(a)[0]]}`}setTimeout(function(){n.hide()},3e3)})}});const bodyLoader=new LiveLoader;bodyLoader.addIdSelector("[name='last_article_id']"),bodyLoader.addBtn("#articles-more-btn"),bodyLoader.addEndPoint("ajax/write/load-articles"),bodyLoader.addListener(t=>{const e=t.articles;Object.entries(e).forEach(([t,e])=>{const a=e,n=`${URL}/write/edit-article/${a.article_id}`,s=`${URL}/write/edit-article/${a.article_id}`,i=isBlank(a.tagline)?"<i class='fs-6'>Title</i> ":ht(a.tagline,100),o=isBlank(a.preview_img)?"":`<img src="${a.preview_img}" class="card-img-top" alt="...">`;document.querySelector("#articles-container").innerHTML+=`\n            <div class="col mb-3">\n            <div class="card shadow-sm">\n                ${o}\n                <div class="card-body">\n                <h4 class='draft-name'><a href="${s}" class='text-dark text-decoration-none'>${ht(a.title,40)}</a></h4>\n                <div class="p-2"></div>\n                <p class="card-text tagline">${i}</p>\n                <p class="card-text">${ht(a.content,200)}</p>\n                <div class="py-2">\n                    <small class="text-muted"><span style='font-weight: 500; font-size: 14px;'>Created: </span> ${a.created_at} </small>\n                    <br>\n                    <small class="text-muted"><span style='font-weight: 500; font-size: 14px;'>Last Edit: </span> ${a.last_updated} </small>\n                </div>\n                <div class="d-flex justify-content-between align-items-center pt-2">\n                    <a type="button" class="btn btn-sm btn-light border d-block w-100 mx-auto" href="${n}">&nbsp;Edit&nbsp;</a>\n                </div>\n                <br>\n\n                    <div class="btn-group mx-auto">\n                    <button type="button" class="btn btn-sm btn-outline-danger delete-article" data-delete-id="${a.article_id}">&nbsp;Delete&nbsp;</button>\n                    <button type="button" class="btn btn-sm btn-outline-primary copy-link" data-link="${s}">Copy Link</button>\n                    </div>\n                </div>\n            </div>\n            </div>\n        `})});
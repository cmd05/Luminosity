import{URL,loginMdl,newTokenData,isJson,LiveLoader,ht}from"./script.js";document.addEventListener("click",e=>{const t=e.target;if(t.classList.contains("toggle-bookmark")){const e=t.getAttribute("data-article-id"),a=newTokenData({article_id:e});fetch(`${URL}/ajax/article/toggle-bookmark`,{method:"POST",body:a}).then(e=>e.text()).then(e=>{isJson(e)?(t.querySelector("i").classList.toggle("far"),t.querySelector("i").classList.toggle("fas")):loginMdl()})}});const bodyLoader=new LiveLoader;function isBlank(e){return!e||/^\s*$/.test(e)}bodyLoader.addIdSelector("[name='last_id']"),bodyLoader.addBtn("#load-more-articles"),bodyLoader.addEndPoint("ajax/home/load-articles"),bodyLoader.addListener(e=>{Object.entries(e.articles).forEach(([e,t])=>{const a=t,n=isBlank(a.preview_img)?"":`<img src="${a.preview_img}" class="preview-img pb-3" alt="...">`,s=a.article_id;document.querySelector(".articles-container").innerHTML+=`\n            <div class="p-1">\n                <div class="card-body row">\n                    <div class="col-12 ms-2">\n                        ${n}\n                        <br>\n                        <a class='mb-3 d-block h3 text-decoration-none text-dark' href="${URL}/article?a=${s}">${ht(a.title,100)}</a>\n\n                        <div class="row mt-4 mb-3">\n                            <div class="col-2 col-sm-1">\n                                <span class="user-img d-inline-block me-3" style='background-image: url(${URL}/uploads/${a.profile_img});'></span>\n                            </div>\n                            <a class="col ps-4 text-dark text-decoration-none" href="${URL}/profile?u=${a.username}">\n                                <p class='py-0 my-0'>${ht(a.display_name)}</p>\n                                <small class="text-muted">@${ht(a.username)}</small>\n                            </a>\n                        </div>\n\n                        <small class="text-muted mb-4 d-block">Published ${a.created_at}</small>\n                        <p class="text-muted" style='font-size: 17px'>${ht(a.tagline,300)}</p>\n                        <p class='article-content'>${ht(a.content,1e3)}</p>\n                        \n                        ${a.view_count} <i class="fas fa-eye"></i>\n  \n                        <button class="btn btn-dark float-end toggle-bookmark" data-article-id="${a.article_id}">\n                            <i class="${a.is_bookmarked?"fas":"far"} fa-bookmark" style='pointer-events: none;'></i>\n                        </button>\n                    </div>\n                    <hr class='my-4'>\n                </div>\n            </div>\n            <br>\n            `})});
import{URL,clipboardCopy,newTokenData,isJson,LiveLoader,ht}from"./script.js";const toast=document.getElementById("articles-toast"),toastBody=toast.querySelector(".toast-body");function isBlank(t){return!t||/^\s*$/.test(t)}document.addEventListener("click",t=>{let a=t.target;if(a.classList.contains("copy-link")){clipboardCopy(a.getAttribute("data-link")),toastBody.innerHTML="Copied Link",new bootstrap.Toast(toast,{delay:2e3}).show()}else if(a.classList.contains("toggle-bookmark")){const t=newTokenData({article_id:a.getAttribute("data-article-id")});fetch(`${URL}/ajax/article/toggle-bookmark`,{method:"POST",body:t}).then(t=>t.text()).then(t=>{if(isJson(t)){if(200===JSON.parse(t).status){const t=a.querySelector("i");t.classList.contains("fas")?(t.classList.remove("fas"),t.classList.add("far")):(t.classList.remove("far"),t.classList.add("fas"))}}})}});const bodyLoader=new LiveLoader;bodyLoader.addIdSelector("[name='last_article_id']"),bodyLoader.addBtn("#articles-more-btn"),bodyLoader.addEndPoint("ajax/bookmarks/load-bookmarks"),bodyLoader.addListener(t=>{const a=t.articles;Object.entries(a).forEach(([t,a])=>{const e=a,s=`${URL}/article?a=${e.article_id}`,o=isBlank(e.tagline)?"<i class='fs-6'>Title</i> ":ht(e.tagline,100),n=isBlank(e.preview_img)?"":`<img src="${e.preview_img}" class="card-img-top" alt="...">`;document.querySelector("#articles-container").innerHTML+=`\n            <div class="col mb-3">\n                <div class="card shadow-sm">\n                    ${n}\n                    <div class="card-body">\n                        <h4 class='draft-name'><a href="${s}" class='text-dark text-decoration-none'>${ht(e.title,40)}</a></h4>\n                        <div class="p-2"></div>\n                        <p class="card-text tagline">${o}</p>\n                        <p class="card-text">${ht(e.content,200)}</p>\n                        \n                        <br>\n\n                        <div class="btn-group mx-auto">\n                            <button type="button" class="btn btn-sm btn-outline-primary copy-link" data-link="${s}">Copy Link</button>\n                        </div>\n\n                        <button type="button" class="toggle-bookmark btn btn-sm btn-primary delete-article float-end" data-article-id="${e.article_id}">\n                            <i class="fas fa-bookmark toggle-bookmark"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `})});